"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkofilm_web"] = self["webpackChunkofilm_web"] || []).push([["src_utils_svgMap_ts"],{

/***/ "./src/utils/svgMap.ts":
/*!*****************************!*\
  !*** ./src/utils/svgMap.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MapSvgRender\": () => (/* binding */ MapSvgRender)\n/* harmony export */ });\n/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! d3 */ \"./node_modules/d3/src/index.js\");\n/* harmony import */ var _lang_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lang/index */ \"./src/lang/index.ts\");\n/* harmony import */ var _config_common__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config/common */ \"./src/config/common.ts\");\n/* harmony import */ var _api_api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../api/api */ \"./src/api/api.ts\");\n\r\n\r\n\r\n\r\nconst assetPath1 = \"M478.208 795.648L359.424 615.424H243.712l-40.96-40.96v-430.08l40.96-40.96h537.6l40.96 40.96v430.08l-40.96 40.96H664.576L545.792 795.648h-67.584zM284.672 533.504h98.304l33.792 18.432L512 698.368l95.232-146.432 33.792-18.432h98.304v-348.16H284.672v348.16z\";\r\nconst assetPath2 = \"M598.016 470.016H425.984l-30.72-30.72V268.288l30.72-30.72h172.032l30.72 30.72V440.32l-30.72 29.696z m-141.312-61.44h110.592V299.008H456.704v109.568z\";\r\nconst assetPath3 = \"M865.28 920.576h-706.56l-31.744-66.56L256 692.224l31.744-15.36h61.44v81.92H307.2l-63.488 79.872h536.576L716.8 758.784h-41.984v-81.92h61.44l31.744 15.36 129.024 161.792z\";\r\nconst personPath1 = \"M507.712 157.696m-93.696 0a1.464 1.464 0 1 0 187.392 0 1.464 1.464 0 1 0-187.392 0Z\";\r\nconst personPath2 = \"M570.624 292.864 448.704 292.864c-41.152 0-78.144 14.976-104.448 38.912l0 172.928 0 46.784 0 21.952 91.648 0 19.712 283.84L567.68 857.28l19.072-283.84 92.992 0L679.744 563.328 679.744 500.224 679.744 336.32C653.248 309.76 614.272 292.864 570.624 292.864z\";\r\nconst personPath3 = \"M654.272 685.376l0 49.408c103.872 15.36 175.232 47.232 175.232 84.032 0 52.032-142.144 94.08-317.44 94.08s-317.504-42.048-317.504-94.08c0-36.928 71.872-68.864 176.448-84.288l0-49.344c-173.632 18.816-298.688 71.488-298.688 133.632C72.192 896.768 269.184 960 512 960c242.816 0 439.744-63.232 439.744-141.12C951.744 756.864 827.264 704.384 654.272 685.376z\";\r\nconst tagPath = \"M210.307143 724.056458a422.3956 422.3956 0 0 1 0-599.801752c166.611598-165.672941 436.774117-165.672941 603.385714 0a422.3956 422.3956 0 0 1 0 599.844418L512 1024l-301.692857-299.943542zM512 554.671556a127.998667 127.998667 0 1 0 0-255.997334 127.998667 127.998667 0 0 0 0 255.997334z\";\r\nconst stationPath1 = \"M815.999828 464.000317c0 58.599967-16.599991 113.199936-45.199975 159.59991-16.199991 26.199985-52.79997 30.299983-74.599957 8.499995-15.799991-15.799991-18.49999-40.299977-6.799996-59.299966C709.299888 540.400274 719.999882 503.000295 719.999882 464.000317c0-55.599969-21.599988-107.799939-60.899965-147.099916S567.599969 256.000435 512 256.000435s-107.799939 21.599988-147.099917 60.899966S304.000118 408.400349 304.000118 464.000317c0 38.999978 10.699994 76.399957 30.599982 108.799939 11.699993 18.999989 8.999995 43.599975-6.799996 59.299966-21.799988 21.799988-58.399967 17.69999-74.599957-8.499995-28.599984-46.399974-45.199974-100.999943-45.199975-159.59991 0-167.899905 136.099923-303.999828 303.999828-303.999828s303.999828 136.099923 303.999828 303.999828z\";\r\nconst stationPath2 = \"M975.999737 465.300316c-0.3 103.799941-34.69998 199.599887-92.499947 276.699844-17.49999 23.399987-51.699971 25.799985-72.299959 5.099997-16.89999-16.89999-18.699989-43.699975-4.299998-62.899965 17.79999-23.799987 32.599982-49.499972 44.299975-77.099956C870.299797 561.900262 879.999792 513.700289 879.999792 464.000317c0-49.699972-9.699995-97.899945-28.899984-143.199919-18.49999-43.799975-45.099974-83.199953-78.899955-116.999933-33.799981-33.799981-73.199959-60.399966-116.999934-78.899956C609.899945 105.70052 561.699972 96.000526 512 96.000526s-97.899945 9.699995-143.199919 28.899983c-43.799975 18.49999-83.199953 45.099974-116.999934 78.899956-33.799981 33.799981-60.399966 73.199959-78.899955 116.999933C153.700203 366.100373 144.000208 414.300345 144.000208 464.000317c0 49.699972 9.699995 97.899945 28.899984 143.199919 11.699993 27.499984 26.499985 53.29997 44.299975 77.099956 14.399992 19.199989 12.599993 45.899974-4.299998 62.899965-20.699988 20.699988-54.899969 18.09999-72.399959-5.299997C82.400243 664.400204 48.000263 568.200258 48.000263 464.000317 48.000263 207.500462 256.100145-0.39942 512.7 0.00058c256.999854 0.4 463.999737 208.299882 463.299737 465.299736z\";\r\nconst stationPath3 = \"M591.999955 960.000036h43.999975c2.199999 0 3.999998 1.799999 3.999998 3.999998v55.999968c0 2.199999-1.799999 3.999998-3.999998 3.999998H388.00007c-2.199999 0-3.999998-1.799999-3.999998-3.999998v-55.999968c0-2.199999 1.799999-3.999998 3.999998-3.999998h43.999975c17.69999 0 31.999982-14.299992 31.999982-31.999982V619.900229c0-20.499988-9.799994-39.899977-26.499985-51.899971-32.599982-23.399987-53.79997-61.799965-53.49997-105.09994 0.5-70.69996 58.999967-127.899928 129.699927-126.999928 69.89996 0.899999 126.299928 57.899967 126.299929 127.999927 0 42.899976-21.099988 80.899954-53.49997 104.099941-16.699991 11.999993-26.499985 31.299982-26.499985 51.799971V928.000054c0 17.69999 14.299992 31.999982 31.999982 31.999982z\";\r\nclass MapSvgRender {\r\n    element; // 渲染容器对象\r\n    transform = { k: 1, x: 0, y: 0 };\r\n    g; // svg对象\r\n    scale = 1; // 真实场景与地图之间的比例\r\n    svgHeight = 500; // 展示高度默认500\r\n    tagList = {}; // 存储所有的标签数据\r\n    messageArea;\r\n    leftInfo;\r\n    rightInfo;\r\n    constructor(element) {\r\n        element.innerHTML = `\r\n            <div class=\"message-area\">\r\n                <div id=\"info_left\"></div>\r\n                <div id=\"info_right\"></div>\r\n                <div class=\"close\">\r\n                <svg t=\"1635753936107\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2399\" width=\"20\" height=\"20\"><path d=\"M571.733333 512l268.8-268.8c17.066667-17.066667 17.066667-42.666667 0-59.733333-17.066667-17.066667-42.666667-17.066667-59.733333 0L512 452.266667 243.2 183.466667c-17.066667-17.066667-42.666667-17.066667-59.733333 0-17.066667 17.066667-17.066667 42.666667 0 59.733333L452.266667 512 183.466667 780.8c-17.066667 17.066667-17.066667 42.666667 0 59.733333 8.533333 8.533333 19.2 12.8 29.866666 12.8s21.333333-4.266667 29.866667-12.8L512 571.733333l268.8 268.8c8.533333 8.533333 19.2 12.8 29.866667 12.8s21.333333-4.266667 29.866666-12.8c17.066667-17.066667 17.066667-42.666667 0-59.733333L571.733333 512z\" p-id=\"2400\" fill=\"#4cf0f5\"></path></svg>\r\n                </div>\r\n            </div>\r\n        `;\r\n        this.element = element;\r\n        const zoom = d3__WEBPACK_IMPORTED_MODULE_0__.zoom().scaleExtent([0.2, 10]);\r\n        const that = this;\r\n        const g = d3__WEBPACK_IMPORTED_MODULE_0__.select(\".\" + this.element.className)\r\n            .append(\"svg\")\r\n            .attr(\"class\", \"out-svg\")\r\n            .attr(\"width\", \"100%\")\r\n            .attr(\"height\", \"100%\")\r\n            .call(zoom.on(\"zoom\", function (event) {\r\n            that.transform = event.transform;\r\n            g.attr(\"transform\", event.transform);\r\n        }))\r\n            .append(\"g\");\r\n        this.g = g;\r\n        const div = document.createElement(\"div\");\r\n        this.messageArea = element.querySelector(\".message-area\") ?? div;\r\n        this.leftInfo = element.querySelector(\"#info_left\") ?? div;\r\n        this.rightInfo = element.querySelector(\"#info_right\") ?? div;\r\n        const close = element.querySelector(\".close\");\r\n        close?.addEventListener(\"click\", () => {\r\n            this.messageArea.style.display = \"none\";\r\n        });\r\n    }\r\n    async insertMap(svgMap) {\r\n        const attr = await this.getMapImageAttr(svgMap);\r\n        this.scale = this.calcScale(attr, svgMap);\r\n        this.svgHeight = attr.height;\r\n        this.element.style.height = attr.height + \"px\";\r\n        this.g\r\n            .append(\"image\")\r\n            .attr(\"xlink:href\", _config_common__WEBPACK_IMPORTED_MODULE_2__.img_base_url + svgMap.url)\r\n            .attr(\"width\", attr.width)\r\n            .attr(\"height\", attr.height);\r\n    }\r\n    // 获取地图图片的宽高\r\n    getMapImageAttr(svgMap) {\r\n        return new Promise((resolve, reject) => {\r\n            let url = _config_common__WEBPACK_IMPORTED_MODULE_2__.img_base_url + svgMap.url;\r\n            let img = new Image();\r\n            1;\r\n            img.src = url;\r\n            img.onload = () => {\r\n                let imgW = img.width, imgH = img.height, svgW = this.element.offsetWidth;\r\n                let computH = Math.floor((svgW * imgH) / imgW);\r\n                resolve({\r\n                    width: svgW,\r\n                    height: computH,\r\n                });\r\n            };\r\n        });\r\n    }\r\n    // 计算比例\r\n    calcScale(attr, svgMap) {\r\n        const width = svgMap.width;\r\n        const height = svgMap.height;\r\n        if (!!width) {\r\n            return attr.width / (width * 1000);\r\n        }\r\n        else {\r\n            return attr.height / (height * 1000);\r\n        }\r\n    }\r\n    // 转换y轴坐标，页面零点在左上，基站定位零点在左下\r\n    switchY(y) {\r\n        return this.svgHeight - y;\r\n    }\r\n    insertStation(station) {\r\n        const that = this;\r\n        const _x = station.x * this.scale - 12;\r\n        const _y = this.switchY(station.y * this.scale + 28);\r\n        const transform = `translate(${_x},${_y}) scale(0.028)`;\r\n        const g = this.g\r\n            .append(\"g\")\r\n            .attr(\"transform\", transform)\r\n            .attr(\"class\", \"svg-station\")\r\n            .style(\"cursor\", \"pointer\")\r\n            .on(\"click\", function () {\r\n            that.showStationMessage(station);\r\n        });\r\n        g.append(\"path\")\r\n            .attr(\"d\", stationPath1)\r\n            .attr(\"fill\", \"#1890ff\");\r\n        g.append(\"path\")\r\n            .attr(\"d\", stationPath2)\r\n            .attr(\"fill\", \"#1890ff\");\r\n        g.append(\"path\")\r\n            .attr(\"d\", stationPath3)\r\n            .attr(\"fill\", \"#1890ff\");\r\n    }\r\n    async renderTag(no, x, y) {\r\n        if (!this.tagList[\"tag\" + no]) {\r\n            const res = await (0,_api_api__WEBPACK_IMPORTED_MODULE_3__.tagGet)({ no });\r\n            if (!res.data)\r\n                return;\r\n            const data = res.data;\r\n            let temp = {\r\n                tagNo: data.t.no,\r\n                tagName: data.t.name,\r\n            };\r\n            if (data.s) {\r\n                this.tagList[\"tag\" + no] = Object.assign(temp, {\r\n                    staffNo: data.s.no,\r\n                    staffName: data.s.name,\r\n                    staffPhone: data.s.phone,\r\n                    picture: data.s.picture,\r\n                    level: data.d.level,\r\n                    dutyName: data.d.name,\r\n                });\r\n            }\r\n            else if (data.a) {\r\n                this.tagList[\"tag\" + no] = Object.assign(temp, {\r\n                    assetNo: data.a.no,\r\n                    assetName: data.a.name,\r\n                    assetModel: data.a.model,\r\n                    assetLevel: data.a.level,\r\n                    personNo: data.a.personNo,\r\n                    personName: data.a.personName,\r\n                });\r\n            }\r\n            else {\r\n                this.tagList[\"tag\" + no] = temp;\r\n            }\r\n            this.insertTag({\r\n                tagNo: data.t.no,\r\n                tagName: data.t.name,\r\n                x: x || data.t.x,\r\n                y: y || data.t.y,\r\n                level: !!data.d ? data.d.level : 0,\r\n            }, (e) => {\r\n                this.showTagMessage(e);\r\n            });\r\n        }\r\n        else {\r\n            this.moveTag(no, x ?? 0, y ?? 0);\r\n        }\r\n    }\r\n    showStationMessage(item) {\r\n        const t = _lang_index__WEBPACK_IMPORTED_MODULE_1__.default.global.t;\r\n        const html = `\r\n            <div>${t(\"columns.no\")}： ${item.no}</div>\r\n            <div>${t(\"columns.name\")}： ${item.name}</div>\r\n            <div>${t(\"columns.algor\")}： ${item.mode}</div>\r\n            <div>${t(\"columns.port\")}： ${item.port}</div>\r\n            <div>${t(\"columns.version\")}： t ${item.version}</div>\r\n            <div>${t(\"columns.ip\")}： ${item.ip}</div>\r\n            <div>x： ${item.x}</div>\r\n            <div>y： ${item.y}</div>\r\n            <div>z： ${item.z}</div>`;\r\n        this.rightInfo.innerHTML = html;\r\n        this.messageArea.style.display = \"flex\";\r\n    }\r\n    showTagMessage(item) {\r\n        const t = _lang_index__WEBPACK_IMPORTED_MODULE_1__.default.global.t;\r\n        const tag = this.tagList[\"tag\" + item.tagNo];\r\n        let html = `\r\n                <div>${t(\"columns.tagNo\")}： ${tag.tagNo}</div>\r\n                <div>${t(\"columns.tagName\")}： ${tag.tagName}</div>\r\n            `;\r\n        if (tag.staffNo) {\r\n            this.leftInfo.innerHTML = `<img width=\"50\" src=\"${_config_common__WEBPACK_IMPORTED_MODULE_2__.img_base_url + tag.picture}\">`;\r\n            html += `\r\n                <div>${t(\"columns.personNo\")}： ${tag.staffNo}</div>\r\n                <div>${t(\"columns.personName\")}： ${tag.staffName}</div>\r\n                <div>${t(\"columns.phone\")}： ${tag.staffPhone}</div>\r\n                <div>${t(\"columns.duty\")}： ${tag.dutyName}</div>`;\r\n        }\r\n        if (tag.assetNo) {\r\n            html += `\r\n                <div>${t(\"columns.assetNo\")}： ${tag.assetNo}</div>\r\n                <div>${t(\"columns.assetName\")}： ${tag.assetName}</div>\r\n                <div>${t(\"columns.assetLevel\")}： ${tag.assetLevel}</div>\r\n                <div>${t(\"columns.assetManager\")}： ${tag.personName}</div>\r\n                <div>${t(\"columns.personNo\")}： ${tag.personNo}</div>`;\r\n        }\r\n        this.rightInfo.innerHTML = html;\r\n        this.messageArea.style.display = \"flex\";\r\n    }\r\n    ;\r\n    insertTag(tag, callback) {\r\n        // 切换坐标  标签图片的大小是30\r\n        const _x = (tag.x ?? 0) * this.scale - 12;\r\n        const _y = this.switchY((tag.y ?? 0) * this.scale + 28);\r\n        const transform = `translate(${_x},${_y}) scale(0.028)`;\r\n        const g = this.g\r\n            .append(\"g\")\r\n            .attr(\"transform\", transform)\r\n            .attr(\"id\", \"svg-tag\" + tag.tagNo)\r\n            .style(\"cursor\", \"pointer\")\r\n            .on(\"click\", function () {\r\n            callback(tag);\r\n        });\r\n        const color = (tag.level ?? 1) > 0 ? _config_common__WEBPACK_IMPORTED_MODULE_2__.colors[(tag.level ?? 1) - 1] : \"#008e59\";\r\n        if (this.tagList[\"tag\" + tag.tagNo].staffNo) {\r\n            g.append(\"path\")\r\n                .attr(\"d\", personPath1)\r\n                .attr(\"fill\", color);\r\n            g.append(\"path\")\r\n                .attr(\"d\", personPath2)\r\n                .attr(\"fill\", color);\r\n            g.append(\"path\")\r\n                .attr(\"d\", personPath3)\r\n                .attr(\"fill\", color);\r\n        }\r\n        //  else if (this.tagList[\"tag\" + tag.tagNo].assetNo) {\r\n        //     g.append(\"path\")\r\n        //         .attr(\"d\", assetPath1)\r\n        //         .attr(\"fill\", color)\r\n        //     g.append(\"path\")\r\n        //         .attr(\"d\", assetPath2)\r\n        //         .attr(\"fill\", color)\r\n        //     g.append(\"path\")\r\n        //         .attr(\"d\", assetPath3)\r\n        //         .attr(\"fill\", color)\r\n        // } \r\n        else {\r\n            g.append(\"path\")\r\n                .attr(\"d\", tagPath)\r\n                .attr(\"fill\", color);\r\n        }\r\n    }\r\n    moveTag(no, x, y) {\r\n        const _x = x * this.scale - 12;\r\n        const _y = this.switchY(y * this.scale + 28);\r\n        const transform = `translate(${_x},${_y}) scale(0.028)`;\r\n        this.g.select(\"#svg-tag\" + no).attr(\"transform\", transform);\r\n    }\r\n    toFullScreen() {\r\n        this.element.requestFullscreen();\r\n    }\r\n    showStations() {\r\n        this.g.selectAll(\".svg-station\").style(\"display\", \"block\");\r\n    }\r\n    hideStations() {\r\n        this.g.selectAll(\".svg-station\").style(\"display\", \"none\");\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://ofilm-web/./src/utils/svgMap.ts?");

/***/ })

}]);